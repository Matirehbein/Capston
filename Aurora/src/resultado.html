<main class="container">
<link rel="stylesheet" href="../Public/Css/style.css" />
  <h2 class="title">ðŸ§¾ Comprobante de compra</h2>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div>
        <div style="font-weight:600">Orden <span id="orderId">â€”</span></div>
        <div class="muted">Fecha: <span id="orderDate">â€”</span></div>
      </div>
      <div class="muted">Total: <b id="orderTotal">$0</b></div>
    </div>

    <div id="items" class="items"></div>

    <div class="totals">
      Subtotal: $<span id="subTotal">0</span><br/>
      EnvÃ­o: $<span id="shipping">0</span><br/>
      <b>Total: $<span id="grandTotal">0</span></b>
    </div>

    <div class="actions" style="display:flex;gap:12px;justify-content:flex-end;">
      <button class="btn ghost" id="btn-print">ðŸ–¨ Imprimir</button>
      <a class="btn" href="./main.html">Volver al inicio</a>
    </div>
  </div>
</main>

<!-- Tu script de colores exactamente con la misma ruta que usas en otras pÃ¡ginas -->
<script type="module" src="../Public/js/colores.js"></script>

<script>
  const $ = s => document.querySelector(s);
  const fmt = n => Number(n||0).toLocaleString('es-CL');

  // 1) Intentamos leer la compra guardada por el carrito
  let compra = null;
  try { compra = JSON.parse(localStorage.getItem('ultimaCompra') || 'null'); } catch {}

  // 2) Si no hay ultimaCompra, usamos el carrito como fallback
  if (!compra) {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const total = cart.reduce((a,p)=> a + (Number(p.price)||0)*(Number(p.qty)||1), 0);
    compra = {
      id: 'ORD-' + Date.now(),
      fecha: new Date().toLocaleString('es-CL'),
      envio: 0,
      total,
      items: cart.map(p => ({
        title: p.name || p.title || 'Producto',
        qty: Number(p.qty)||1,
        price: Number(p.price)||0,
        image: p.image || ''
      }))
    };
  }

  // 3) Render
  $('#orderId').textContent = compra.id;
  $('#orderDate').textContent = compra.fecha;
  $('#orderTotal').textContent = '$' + fmt(compra.total);

  const cont = $('#items'); cont.innerHTML = '';
  let sub = 0;
  (compra.items || []).forEach(it => {
    const line = (Number(it.price)||0) * (Number(it.qty)||1);
    sub += line;
    const row = document.createElement('div');
    row.className = 'item';
    row.style = 'display:grid;grid-template-columns:70px 1fr auto;gap:14px;padding:14px 0;border-bottom:1px dashed #eee';
    row.innerHTML = `
      <img class="thumb" src="${it.image||''}" alt="" style="width:70px;height:70px;object-fit:cover;border-radius:8px;background:#f1f1f1">
      <div>
        <p class="name" style="margin:0 0 4px;font-weight:600">${it.title}</p>
        <div class="meta" style="color:#777;font-size:.9rem">x${it.qty} â€¢ $${fmt(it.price)} c/u</div>
      </div>
      <div class="price" style="font-weight:700;white-space:nowrap">$${fmt(line)}</div>
    `;
    cont.appendChild(row);
  });

  const envio = Number(compra.envio||0);
  $('#subTotal').textContent  = fmt(sub);
  $('#shipping').textContent  = fmt(envio);
  $('#grandTotal').textContent = fmt(sub + envio);

  // 4) Imprimir
  document.getElementById('btn-print').addEventListener('click', () => window.print());
</script>
